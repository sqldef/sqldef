# TODO: Migration from pgquery to generic parser

This document tracks the failing tests when using `PSQLDEF_PARSER=generic`.

**Total failing tests: 10**

## Principle of Operation

* We are migrating from `pgquery` to `generic` parser, discarding `pgquery` in the future.
* However, `pgquery` will be kept for a while as a fallback parser.
* If something conflicts, the generic parser's way is correct. Update `pgquery` stuff to adjust to the generic parser's way.
* You can add test cases to debug, but do not modify the existing test cases.
* `parser/parser_test.go` is the test cases for the generic parser. Use it to develop the parser stuff.
* Wen you add `slog.Debug()` for debugging, you don't need to remove them after the task is done.
* Keep `TODO.md` up-to-date, just removing completed tasks, instead of marking them as done.

## Summary by Issue Type

- **Remaining failures**: 10 tests
  - PostgreSQL type aliases: 3 tests (timestamptz/timetz need normalization)
  - Other: 7 tests (default expressions, index expressions, views, foreign keys)

## Known Pre-Existing Issues (Not Related to Generic Parser)

**MySQL**:
- `CheckDuplicateValuesInOrChain` - expects OR chain deduplication and conversion to IN (not implemented)

**SQL Server**:
- 10 CHECK constraint tests failing due to SQL Server's own normalization differences (pre-existing)

## Remaining Test Failures (10 tests)

### PostgreSQL Type Alias Tests (3 tests)
- AddTimestamptzColumnOnNonStandardDefaultSchema - `timestamptz` should normalize to `timestamp WITH TIME ZONE`
- AddTimetzColumnOnNonStandardDefaultSchema - `timetz` should normalize to `time WITH TIME ZONE`
- AddEnumTypeColumnWithExplicitSchemaOnNonStandardDefaultSchema - Enum type schema handling

**Note**: Generic parser uses PostgreSQL type aliases (`timestamptz`, `timetz`) while pgquery uses canonical forms (`timestamp WITH TIME ZONE`, `time WITH TIME ZONE`). Need type normalization in generator for consistent comparison.

### Other TestApply Failures (7 tests)
- ChangeDefaultExpressionWithAddition - Migration output mismatch
- ChangeTimezoneSyntax - Both schemas not idempotent, timezone syntax not preserved
- CreateIndexWithBoolExpr - Desired schema not idempotent
- IndexesOnChangedExpressions - Migration output mismatch
- CreateTableWithDefault - Issue unknown
- CreateViewWithCaseWhen - Issue unknown
- LongAutoGeneratedForeignKeyConstraint - Issue unknown
