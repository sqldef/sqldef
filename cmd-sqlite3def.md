# sqlite3def

```
Usage:
  sqlite3def [OPTIONS] [FILENAME|current.sql] < desired.sql

Application Options:
  -f, --file=FILENAME         Read desired SQL from the file, rather than stdin (default: -)
      --dry-run               Don't run DDLs but just show them
      --export                Just dump the current schema to stdout
      --enable-drop           Enable destructive changes such as DROP for TABLE, SCHEMA, ROLE, USER, FUNCTION, PROCEDURE, TRIGGER, VIEW, INDEX, SEQUENCE, TYPE
      --config=PATH           YAML configuration file (can be specified multiple times)
      --config-inline=YAML    YAML configuration as inline string (can be specified multiple times)
      --help                  Show this help
      --version               Show version information
```

## Synopsis

```shell
# Create SQLite database and tables
$ sqlite3 mydb.db "CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT);"

# Export current schema
$ sqlite3def mydb.db --export
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    name TEXT
);

# Save it to edit
$ sqlite3def mydb.db --export > schema.sql
```

Update schema.sql as follows:

```diff
 CREATE TABLE users (
     id INTEGER PRIMARY KEY,
-    name TEXT
+    name TEXT,
+    email TEXT NOT NULL
 );
+
+CREATE INDEX idx_users_email ON users(email);
```

And then run:

```shell
# Preview migration plan (dry run)
$ sqlite3def mydb.db --dry-run < schema.sql
-- dry run --
BEGIN;
ALTER TABLE users ADD COLUMN email TEXT NOT NULL;
CREATE INDEX idx_users_email ON users(email);
COMMIT;

# Apply DDLs
$ sqlite3def mydb.db < schema.sql
-- Apply --
BEGIN;
ALTER TABLE users ADD COLUMN email TEXT NOT NULL;
CREATE INDEX idx_users_email ON users(email);
COMMIT;

# Operations are idempotent - safe to run multiple times
$ sqlite3def mydb.db < schema.sql
-- Nothing is modified --

# Run without dropping tables and columns
$ sqlite3def mydb.db < schema.sql
-- Skipped: DROP TABLE old_users;

# Run with drop operations enabled
$ sqlite3def mydb.db --enable-drop < schema.sql
-- Apply --
BEGIN;
DROP TABLE old_users;
COMMIT;

# Use config file to filter tables
$ cat > config.yml <<EOF
target_tables: |
  users
  posts_\d+
skip_tables: |
  sqlite_.*
  temp_.*
EOF
$ sqlite3def mydb.db --config=config.yml < schema.sql

# Use inline YAML configuration
$ sqlite3def mydb.db --config-inline="skip_tables: backup_.*" < schema.sql

# Multiple configs (later values override earlier ones)
$ sqlite3def mydb.db --config=config.yml --config-inline="target_tables: users" < schema.sql
```

## Supported features

The following DDLs are generated by updating `CREATE TABLE`.
Some can also be used in the input schema.sql file.

- Table: CREATE TABLE, DROP TABLE, CREATE VIRTUAL TABLE
- Column: ADD COLUMN, DROP COLUMN
- Index: CREATE INDEX, DROP INDEX
- View: CREATE VIEW, DROP VIEW

## Configuration

Configuration can be provided through YAML files (`--config`) or inline YAML strings (`--config-inline`). Multiple configurations can be specified and will be merged in order.

### Using Configuration Files

```shell
$ sqlite3def mydb.db --config config.yml < schema.sql
```

### Using Inline Configuration

```shell
$ sqlite3def mydb.db --config-inline 'enable_drop: true' < schema.sql
```

### Combining Multiple Configurations

```shell
$ sqlite3def mydb.db \
  --config base.yml \
  --config-inline 'skip_tables: [logs, temp_data]' \
  --config-inline 'enable_drop: true' \
  < schema.sql
```

### Available Configuration Options

| Field | Type | Description |
|-------|------|-------------|
| `enable_drop` | boolean | Enable destructive changes (DROP statements). Equivalent to `--enable-drop` flag. |
| `target_tables` | string | Regular expression patterns (one per line) to specify which tables to manage. Only tables matching these patterns will be processed. |
| `skip_tables` | string | Regular expression patterns (one per line) to specify which tables to skip. Tables matching these patterns will be ignored. |
| `skip_views` | string | Regular expression patterns (one per line) to specify which views to skip. |
