# Tests for quote-aware mode (legacy_ignore_quotes: false) in MySQL
#
# IMPORTANT: MySQL table name case sensitivity depends on lower_case_table_names:
# - 0 (Linux default): Case-sensitive - Users and users are DIFFERENT tables
# - 1 or 2 (macOS/Windows): Case-insensitive - Users and users are the SAME table
#
# These tests are designed for lower_case_table_names=0 (case-sensitive, Linux).

# Basic quote-aware test: case-preserving but identical case names work
BasicQuoteAwareTableCreation:
  legacy_ignore_quotes: false
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
  up: |
    CREATE TABLE users (id int PRIMARY KEY);

  down: |
    DROP TABLE `users`;
# FK dependency ordering with consistent case
ForeignKeyDependencyOrderingConsistentCase:
  legacy_ignore_quotes: false
  desired: |
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users (id)
    );
    CREATE TABLE users (id int PRIMARY KEY);
  up: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users (id)
    );

  down: |
    DROP TABLE `orders`;
    DROP TABLE `users`;
# Add column with quote-aware mode
AddColumnQuoteAware:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int PRIMARY KEY, name varchar(100));
  up: |
    ALTER TABLE users ADD COLUMN name varchar(100) AFTER id;

  down: |
    ALTER TABLE users DROP COLUMN `name`;
# Drop column with quote-aware mode
DropColumnQuoteAware:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY, old_col varchar(50));
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
  up: |
    ALTER TABLE users DROP COLUMN `old_col`;

  down: |
    ALTER TABLE users ADD COLUMN old_col varchar(50) AFTER id;
# Modify column with quote-aware mode
ModifyColumnQuoteAware:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (id int PRIMARY KEY, price int);
  desired: |
    CREATE TABLE products (id int PRIMARY KEY, price bigint NOT NULL);
  up: |
    ALTER TABLE products CHANGE COLUMN `price` price bigint NOT NULL;

  down: |
    ALTER TABLE products CHANGE COLUMN `price` price int;
# Add index with quote-aware mode
AddIndexQuoteAware:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE items (id int PRIMARY KEY, name varchar(100));
  desired: |
    CREATE TABLE items (id int PRIMARY KEY, name varchar(100), INDEX idx_name (name));
  up: |
    ALTER TABLE items ADD INDEX idx_name (name);

  down: |
    ALTER TABLE `items` DROP INDEX `idx_name`;
# Drop index with quote-aware mode
DropIndexQuoteAware:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE items (id int PRIMARY KEY, name varchar(100), INDEX idx_name (name));
  desired: |
    CREATE TABLE items (id int PRIMARY KEY, name varchar(100));
  up: |
    ALTER TABLE `items` DROP INDEX `idx_name`;

  down: |
    ALTER TABLE items ADD INDEX idx_name (name);
# Demonstrate that lower_case_table_names only affects TABLE names, not column/index names.
# In MySQL, column and index names are always case-insensitive regardless of lower_case_table_names.
# This test verifies that a column with different case (Name vs name) is recognized as the same column.
ColumnNameCaseInsensitive:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY, Name varchar(100));
  desired: |
    CREATE TABLE users (id int PRIMARY KEY, name varchar(100), email varchar(200));
  up: |
    ALTER TABLE users ADD COLUMN email varchar(200) AFTER name;

  down: |
    ALTER TABLE users DROP COLUMN `email`;
# Index name case insensitivity - MySQL index names are case-insensitive
IndexNameCaseInsensitive:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (id int PRIMARY KEY, name varchar(100), INDEX IDX_NAME (name));
  desired: |
    CREATE TABLE products (id int PRIMARY KEY, name varchar(100), INDEX idx_name (name));
  # No output - index names match case-insensitively
  up: ""
  down: ""

# Check constraint name case insensitivity - MySQL constraint names are case-insensitive
CheckConstraintNameCaseInsensitive:
  legacy_ignore_quotes: false
  min_version: "8.0.16"
  current: |
    CREATE TABLE orders (
      id int PRIMARY KEY,
      quantity int,
      CONSTRAINT CHK_QUANTITY CHECK (quantity > 0)
    );
  desired: |
    CREATE TABLE orders (
      id int PRIMARY KEY,
      quantity int,
      CONSTRAINT chk_quantity CHECK (quantity > 0)
    );
  # No output - constraint names match case-insensitively
  up: ""
  down: ""
