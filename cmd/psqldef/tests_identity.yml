# yaml-language-server: $schema=../../testutil/testcase.schema.json
CreateIdentityColumnWithNegativeValue:
  desired: |
    CREATE TABLE test_sequence_negative (
      id1 bigint GENERATED ALWAYS AS IDENTITY (
        START WITH -100
        INCREMENT BY -5
        MINVALUE -1000
        MAXVALUE -10
        CACHE 20
      ),
      id2 bigint GENERATED ALWAYS AS IDENTITY (
        START -50
        INCREMENT -2
      ),
      id3 bigint GENERATED ALWAYS AS IDENTITY (
        MINVALUE -500
        MAXVALUE 0
      ),
      id4 bigint GENERATED ALWAYS AS IDENTITY (
        START WITH -1
        INCREMENT BY 1
        MINVALUE -100
        MAXVALUE 100
        CACHE 10
      )
    );

CreateTableWithIdentityAlways:
  desired: |
    CREATE TABLE color (
      color_id INT GENERATED ALWAYS AS IDENTITY,
      color_name VARCHAR NOT NULL
    );

AddIdentityToExistingColumn:
  current: |
    CREATE TABLE color (
      color_id INT NOT NULL,
      color_name VARCHAR NOT NULL
    );
  desired: |
    CREATE TABLE color (
      color_id INT GENERATED BY DEFAULT AS IDENTITY,
      color_name VARCHAR NOT NULL
    );
  up: |
    ALTER TABLE "color" ALTER COLUMN "color_id" ADD GENERATED BY DEFAULT AS IDENTITY;
  down: |
    ALTER TABLE "color" ALTER COLUMN "color_id" DROP IDENTITY IF EXISTS;
RemoveIdentityFromColumn:
  current: |
    CREATE TABLE color (
      color_id INT GENERATED BY DEFAULT AS IDENTITY,
      color_name VARCHAR NOT NULL
    );
  desired: |
    CREATE TABLE color (
      color_id INT NOT NULL,
      color_name VARCHAR NOT NULL
    );
  up: |
    ALTER TABLE "color" ALTER COLUMN "color_id" DROP IDENTITY IF EXISTS;
  down: |
    ALTER TABLE "color" ALTER COLUMN "color_id" ADD GENERATED BY DEFAULT AS IDENTITY;
ChangeIdentityFromByDefaultToAlways:
  current: |
    CREATE TABLE color (
      color_id INT GENERATED BY DEFAULT AS IDENTITY,
      color_name VARCHAR NOT NULL
    );
  desired: |
    CREATE TABLE color (
      color_id INT GENERATED ALWAYS AS IDENTITY,
      color_name VARCHAR NOT NULL
    );
  up: |
    ALTER TABLE "color" ALTER COLUMN "color_id" SET GENERATED ALWAYS;
  down: |
    ALTER TABLE "color" ALTER COLUMN "color_id" SET GENERATED BY DEFAULT;
IdentityWithSequenceOptions:
  desired: |
    CREATE TABLE voltages (
      volt int GENERATED BY DEFAULT AS IDENTITY
        (START WITH -200 INCREMENT BY 10 MINVALUE -200 MAXVALUE 200)
    );

# Note: Sequence option changes are not supported, so this should result in no change
IdentitySequenceOptionsIgnored:
  current: |
    CREATE TABLE voltages (
      volt int GENERATED BY DEFAULT AS IDENTITY
        (START WITH -200 INCREMENT BY 10 MINVALUE -200 MAXVALUE 200)
    );
  desired: |
    CREATE TABLE voltages (
      volt int GENERATED BY DEFAULT AS IDENTITY
        (START WITH -100 INCREMENT BY 5 MINVALUE -100 MAXVALUE 100)
    );

AddIdentityWithSequenceToExistingColumn:
  current: |
    CREATE TABLE voltages (
      volt int
    );
  desired: |
    CREATE TABLE voltages (
      volt int GENERATED BY DEFAULT AS IDENTITY
        (START WITH -100 INCREMENT BY 5 MINVALUE -100 MAXVALUE 100)
    );
  up: |
    ALTER TABLE "voltages" ALTER COLUMN "volt" SET NOT NULL;
    ALTER TABLE "voltages" ALTER COLUMN "volt" ADD GENERATED BY DEFAULT AS IDENTITY (START WITH -100 INCREMENT BY 5 MINVALUE -100 MAXVALUE 100);
  down: |
    ALTER TABLE "voltages" ALTER COLUMN "volt" DROP IDENTITY IF EXISTS;
    ALTER TABLE "voltages" ALTER COLUMN "volt" DROP NOT NULL;
AddNewIdentityColumnWithSequence:
  current: |
    CREATE TABLE voltages (
      name varchar NOT NULL
    );
  desired: |
    CREATE TABLE voltages (
      name varchar NOT NULL,
      volt int GENERATED BY DEFAULT AS IDENTITY
        (START WITH -100 INCREMENT BY 5 MINVALUE -100 MAXVALUE 100)
    );
  up: |
    ALTER TABLE "voltages" ADD COLUMN "volt" integer GENERATED BY DEFAULT AS IDENTITY (START WITH -100 INCREMENT BY 5 MINVALUE -100 MAXVALUE 100);
  down: |
    ALTER TABLE "voltages" DROP COLUMN "volt";
