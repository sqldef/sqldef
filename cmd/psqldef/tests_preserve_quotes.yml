# This test file is to test `legacy_ignore_quotes: false` behavior.

TableQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
  desired: |
    CREATE TABLE "Users" (id int, name text);
  output: |
    ALTER TABLE public."Users" ADD COLUMN name text;

TableUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE Users (id int);
  desired: |
    CREATE TABLE Users (id int, name text);
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

TableQuotedVsUnquotedAreDifferent:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
    CREATE TABLE users (id int);
  desired: |
    CREATE TABLE "Users" (id int, name text);
    CREATE TABLE users (id int, email text);
  output: |
    ALTER TABLE public."Users" ADD COLUMN name text;
    ALTER TABLE public.users ADD COLUMN email text;

ColumnQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users ("Name" text);
  desired: |
    CREATE TABLE users ("Name" text NOT NULL);
  output: |
    ALTER TABLE public.users ALTER COLUMN "Name" SET NOT NULL;

ColumnUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (Name text);
  desired: |
    CREATE TABLE users (Name text NOT NULL);
  output: |
    ALTER TABLE public.users ALTER COLUMN name SET NOT NULL;

ColumnQuotedVsUnquotedAreDifferent:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users ("Name" text, name text);
  desired: |
    CREATE TABLE users ("Name" text NOT NULL, name text NOT NULL);
  output: |
    ALTER TABLE public.users ALTER COLUMN "Name" SET NOT NULL;
    ALTER TABLE public.users ALTER COLUMN name SET NOT NULL;

# Equivalence tests: quoted lowercase should equal unquoted (current=unquoted, desired=quoted)
# In PostgreSQL, "users" (quoted lowercase) and users (unquoted) refer to the same identifier
# These test the opposite direction from the tests at the end of this file
TableUnquotedEqualsQuotedLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
  desired: |
    CREATE TABLE "users" (id int);
  output: ""

ColumnUnquotedEqualsQuotedLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (name text);
  desired: |
    CREATE TABLE users ("name" text);
  output: ""

ConstraintUnquotedEqualsQuotedLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT email_unique UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT "email_unique" UNIQUE (email)
    );
  output: ""

IndexUnquotedEqualsQuotedLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX email_idx ON users (email);
  desired: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX "email_idx" ON users (email);
  output: ""

ViewQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int, name text);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

ViewUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW ActiveUsers AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int, name text);
    CREATE VIEW ActiveUsers AS SELECT id FROM users;
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

TypeQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE "UserStatus" AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status "UserStatus");
  desired: |
    CREATE TYPE "UserStatus" AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status "UserStatus", name text);
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

TypeUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE UserStatus AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status userstatus);
  desired: |
    CREATE TYPE UserStatus AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status userstatus, name text);
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

DomainQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE DOMAIN "PositiveInt" AS int CHECK (VALUE > 0);
    CREATE TABLE users (id "PositiveInt");
  desired: |
    CREATE DOMAIN "PositiveInt" AS int CHECK (VALUE > 0);
    CREATE TABLE users (id "PositiveInt", score "PositiveInt");
  output: |
    ALTER TABLE public.users ADD COLUMN score "PositiveInt";

DomainUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE DOMAIN PositiveInt AS int CHECK (VALUE > 0);
    CREATE TABLE users (id positiveint);
  desired: |
    CREATE DOMAIN PositiveInt AS int CHECK (VALUE > 0);
    CREATE TABLE users (id positiveint, score positiveint);
  output: |
    ALTER TABLE public.users ADD COLUMN score positiveint;

IndexQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX "EmailIndex" ON users (email);
  desired: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX "EmailIndex" ON users (email);
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

IndexUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX EmailIndex ON users (email);
  desired: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX EmailIndex ON users (email);
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

ConstraintQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int CONSTRAINT "PrimaryKey" PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int CONSTRAINT "PrimaryKey" PRIMARY KEY, email text UNIQUE);
  output: |
    ALTER TABLE public.users ADD COLUMN email text UNIQUE;

ConstraintUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int CONSTRAINT PrimaryKey PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int CONSTRAINT PrimaryKey PRIMARY KEY, email text UNIQUE);
  output: |
    ALTER TABLE public.users ADD COLUMN email text UNIQUE;

MixedQuotedAndUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
    CREATE TABLE users (id int);
  desired: |
    CREATE TABLE "Users" ("Name" text);
    CREATE TABLE users (name text);
  output: |
    ALTER TABLE public."Users" ADD COLUMN "Name" text;
    ALTER TABLE public.users ADD COLUMN name text;
    ALTER TABLE public."Users" DROP COLUMN id;
    ALTER TABLE public.users DROP COLUMN id;

ComplexMixedCaseScenario:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "UserProfiles" (
      "UserId" int,
      user_name text
    );
  desired: |
    CREATE TABLE "UserProfiles" (
      "UserId" int PRIMARY KEY,
      user_name text NOT NULL,
      "CreatedAt" timestamp DEFAULT CURRENT_TIMESTAMP
    );
  output: |
    ALTER TABLE public."UserProfiles" ALTER COLUMN user_name SET NOT NULL;
    ALTER TABLE public."UserProfiles" ADD COLUMN "CreatedAt" timestamp DEFAULT current_timestamp;
    ALTER TABLE public."UserProfiles" ADD PRIMARY KEY ("UserId");

ForeignKeyToQuotedTable:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (
      "UserId" int PRIMARY KEY
    );
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int
    );
  desired: |
    CREATE TABLE "Users" (
      "UserId" int PRIMARY KEY
    );
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES "Users" ("UserId")
    );
  output: |
    ALTER TABLE public.orders ADD CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES public."Users" ("UserId");

ForeignKeyWithQuotedConstraintName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (id int PRIMARY KEY, user_id int);
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_Orders_Users" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  output: |
    ALTER TABLE public.orders ADD CONSTRAINT "FK_Orders_Users" FOREIGN KEY (user_id) REFERENCES public.users (id);

ForeignKeyBetweenQuotedAndUnquotedTables:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE "Orders" (id int PRIMARY KEY, quoted_user_id int, unquoted_user_id int);
  desired: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE "Orders" (
      id int PRIMARY KEY,
      quoted_user_id int,
      unquoted_user_id int,
      CONSTRAINT "fk_quoted" FOREIGN KEY (quoted_user_id) REFERENCES "Users" ("UserId"),
      CONSTRAINT fk_unquoted FOREIGN KEY (unquoted_user_id) REFERENCES users (id)
    );
  output: |
    ALTER TABLE public."Orders" ADD CONSTRAINT "fk_quoted" FOREIGN KEY (quoted_user_id) REFERENCES public."Users" ("UserId");
    ALTER TABLE public."Orders" ADD CONSTRAINT fk_unquoted FOREIGN KEY (unquoted_user_id) REFERENCES public.users (id);

ArrayTypeWithQuotedCustomType:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE "UserRole" AS ENUM ('admin', 'user');
    CREATE TABLE users (id int);
  desired: |
    CREATE TYPE "UserRole" AS ENUM ('admin', 'user');
    CREATE TABLE users (id int, roles "UserRole"[]);
  output: |
    ALTER TABLE public.users ADD COLUMN roles "UserRole"[];

ArrayTypeWithUnquotedCustomType:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE userrole AS ENUM ('admin', 'user');
    CREATE TABLE users (id int);
  desired: |
    CREATE TYPE userrole AS ENUM ('admin', 'user');
    CREATE TABLE users (id int, roles userrole[]);
  output: |
    ALTER TABLE public.users ADD COLUMN roles userrole[];

CheckConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (id int, price int);
  desired: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT "Price_Positive" CHECK (price > 0)
    );
  output: |
    ALTER TABLE public.products ADD CONSTRAINT "Price_Positive" CHECK (price > 0);

CheckConstraintQuotedVsUnquotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT "Price_Check" CHECK (price > 0)
    );
  desired: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT Price_Check CHECK (price > 0)
    );
  output: |
    ALTER TABLE public.products DROP CONSTRAINT "Price_Check";
    ALTER TABLE public.products ADD CONSTRAINT price_check CHECK (price > 0);

UniqueConstraintQuotedColumns:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users ("Email" text, "Username" text);
  desired: |
    CREATE TABLE users (
      "Email" text,
      "Username" text,
      CONSTRAINT "unique_email" UNIQUE ("Email")
    );
  output: |
    ALTER TABLE public.users ADD CONSTRAINT "unique_email" UNIQUE ("Email");

DropTableQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
  desired: ""
  output: |
    DROP TABLE public."Users";

DropTableQuotedVsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
    CREATE TABLE users (id int);
  desired: |
    CREATE TABLE users (id int);
  output: |
    DROP TABLE public."Users";

DropIndexQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX "EmailIndex" ON users (email);
  desired: |
    CREATE TABLE users (id int, email text);
  output: |
    DROP INDEX public."EmailIndex";

DropIndexQuotedVsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX "NameIndex" ON users (name);
    CREATE INDEX emailindex ON users (email);
  desired: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX emailindex ON users (email);
  output: |
    DROP INDEX public."NameIndex";

DropViewQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int);
  output: |
    DROP VIEW public."ActiveUsers";

DropViewQuotedVsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
    CREATE VIEW activeusers AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int);
    CREATE VIEW activeusers AS SELECT id FROM users;
  output: |
    DROP VIEW public."ActiveUsers";

DropForeignKeyQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_Orders_Users" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (id int PRIMARY KEY, user_id int);
  output: |
    ALTER TABLE public.orders DROP CONSTRAINT "FK_Orders_Users";

# Note: When tables come from database, PostgreSQL always quotes identifiers in exports,
# so we can't distinguish originally-quoted vs originally-unquoted table names.
# The default schema "public" is treated as unquoted (lowercase), but the table name
# "users" remains quoted because the database export quotes all identifiers.
DropUniqueConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT "Unique_Email" UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (id int, email text);
  output: |
    ALTER TABLE public."users" DROP CONSTRAINT "Unique_Email";

DropCheckConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (
      id int,
      price int,
      CONSTRAINT "Price_Positive" CHECK (price > 0)
    );
  desired: |
    CREATE TABLE products (id int, price int);
  output: |
    ALTER TABLE public.products DROP CONSTRAINT "Price_Positive";

QuotedReservedWordAsTableName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "select" (id int);
  desired: |
    CREATE TABLE "select" (id int, "from" text);
  output: |
    ALTER TABLE public."select" ADD COLUMN "from" text;

DropQuotedReservedWordTable:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "table" (id int);
  desired: ""
  output: |
    DROP TABLE public."table";

QuotedIdentifierWithSpace:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "User Profiles" (id int);
  desired: |
    CREATE TABLE "User Profiles" (id int, "Full Name" text);
  output: |
    ALTER TABLE public."User Profiles" ADD COLUMN "Full Name" text;

ModifyUniqueConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      name text,
      CONSTRAINT "Unique_Email" UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (
      id int,
      email text,
      name text,
      CONSTRAINT "Unique_Email" UNIQUE (email, name)
    );
  output: |
    ALTER TABLE public.users DROP CONSTRAINT "Unique_Email";
    ALTER TABLE public.users ADD CONSTRAINT "Unique_Email" UNIQUE ("email", "name");

RenameUniqueConstraintQuotedToUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT "Email_Unique" UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT email_unique UNIQUE (email)
    );
  output: |
    ALTER TABLE public.users ADD CONSTRAINT email_unique UNIQUE ("email");
    ALTER TABLE public."users" DROP CONSTRAINT "Email_Unique";

ForeignKeyMixedQuotedReferences:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Categories" ("CategoryId" int PRIMARY KEY);
    CREATE TABLE categories (id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      quoted_cat_id int,
      unquoted_cat_id int
    );
  desired: |
    CREATE TABLE "Categories" ("CategoryId" int PRIMARY KEY);
    CREATE TABLE categories (id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      quoted_cat_id int,
      unquoted_cat_id int,
      CONSTRAINT "fk_QuotedCat" FOREIGN KEY (quoted_cat_id) REFERENCES "Categories" ("CategoryId"),
      CONSTRAINT fk_unquoted_cat FOREIGN KEY (unquoted_cat_id) REFERENCES categories (id)
    );
  output: |
    ALTER TABLE public.products ADD CONSTRAINT "fk_QuotedCat" FOREIGN KEY (quoted_cat_id) REFERENCES public."Categories" ("CategoryId");
    ALTER TABLE public.products ADD CONSTRAINT fk_unquoted_cat FOREIGN KEY (unquoted_cat_id) REFERENCES public.categories (id);

DropForeignKeyKeepQuotedTable:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE "Orders" (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_Order_User" FOREIGN KEY (user_id) REFERENCES "Users" ("UserId")
    );
  desired: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE "Orders" (id int PRIMARY KEY, user_id int);
  output: |
    ALTER TABLE public."Orders" DROP CONSTRAINT "FK_Order_User";

AddPrimaryKeyQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" ("UserId" int);
  desired: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
  output: |
    ALTER TABLE public."Users" ADD PRIMARY KEY ("UserId");

DropPrimaryKeyQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int NOT NULL);
  output: |
    ALTER TABLE public.users DROP CONSTRAINT users_pkey;

RenameQuotedColumnToUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "UserName" text
    );
  desired: |
    CREATE TABLE users (
      id int,
      username text -- @renamed from="UserName"
    );
  output: |
    ALTER TABLE public.users RENAME COLUMN "UserName" TO username;

RenameUnquotedColumnToQuoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      username text
    );
  desired: |
    CREATE TABLE users (
      id int,
      "UserName" text -- @renamed from=username
    );
  output: |
    ALTER TABLE public.users RENAME COLUMN username TO "UserName";

RenameQuotedColumnToQuoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "OldName" text
    );
  desired: |
    CREATE TABLE users (
      id int,
      "NewName" text -- @renamed from="OldName"
    );
  output: |
    ALTER TABLE public.users RENAME COLUMN "OldName" TO "NewName";

RenameQuotedColumnWithTypeChange:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "UserName" varchar(50)
    );
  desired: |
    CREATE TABLE users (
      id int,
      username text NOT NULL -- @renamed from="UserName"
    );
  output: |
    ALTER TABLE public.users RENAME COLUMN "UserName" TO username;
    ALTER TABLE public.users ALTER COLUMN username TYPE text;
    ALTER TABLE public.users ALTER COLUMN username SET NOT NULL;

RenameQuotedTableToUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "UserAccounts" (
      id int,
      name text
    );
  desired: |
    CREATE TABLE user_accounts ( -- @renamed from="UserAccounts"
      id int,
      name text
    );
  output: |
    ALTER TABLE public."UserAccounts" RENAME TO user_accounts;

RenameUnquotedTableToQuoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE user_accounts (
      id int,
      name text
    );
  desired: |
    CREATE TABLE "UserAccounts" ( -- @renamed from=user_accounts
      id int,
      name text
    );
  output: |
    ALTER TABLE public.user_accounts RENAME TO "UserAccounts";

RenameQuotedIndexToUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text
    );
    CREATE INDEX "EmailIndex" ON users (email);
  desired: |
    CREATE TABLE users (
      id int,
      email text
    );
    CREATE INDEX email_idx /* @renamed from="EmailIndex" */ ON users (email);
  output: |
    ALTER INDEX public."EmailIndex" RENAME TO email_idx;

RenameUnquotedIndexToQuoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text
    );
    CREATE INDEX email_idx ON users (email);
  desired: |
    CREATE TABLE users (
      id int,
      email text
    );
    CREATE INDEX "EmailIndex" /* @renamed from=email_idx */ ON users (email);
  output: |
    ALTER INDEX public.email_idx RENAME TO "EmailIndex";

QuotedSchemaName:
  legacy_ignore_quotes: false
  current: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema"."Users" (id int);
  desired: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema"."Users" (id int, name text);
  output: |
    ALTER TABLE "MySchema"."Users" ADD COLUMN name text;

QuotedSchemaWithUnquotedTable:
  legacy_ignore_quotes: false
  current: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema".users (id int);
  desired: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema".users (id int, name text);
  output: |
    ALTER TABLE "MySchema".users ADD COLUMN name text;

CheckConstraintMixedQuotedColumns:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE orders (
      id int,
      min_price int,
      max_price int
    );
  desired: |
    CREATE TABLE orders (
      id int,
      min_price int,
      max_price int,
      CONSTRAINT "Price_Range" CHECK (min_price < max_price)
    );
  output: |
    ALTER TABLE public.orders ADD CONSTRAINT "Price_Range" CHECK (min_price < max_price);

CheckConstraintQuotedConstraintName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (
      id int,
      price int
    );
  desired: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT "Positive_Price" CHECK (price > 0)
    );
  output: |
    ALTER TABLE public.products ADD CONSTRAINT "Positive_Price" CHECK (price > 0);

RenameQuotedLowercaseToUnquotedNoOp:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "username" text
    );
  desired: |
    CREATE TABLE users (
      id int,
      username text
    );
  output: ""

RenameQuotedMixedCaseToUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "UserName" text
    );
  desired: |
    CREATE TABLE users (
      id int,
      username text -- @renamed from="UserName"
    );
  output: |
    ALTER TABLE public.users RENAME COLUMN "UserName" TO username;

TableQuotedLowercaseEqualsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "users" (id int);
  desired: |
    CREATE TABLE users (id int, name text);
  output: |
    ALTER TABLE public.users ADD COLUMN name text;

IndexQuotedLowercaseEqualsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX "email_idx" ON users (email);
  desired: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX email_idx ON users (email);
  output: ""

ConstraintQuotedLowercaseEqualsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT "users_email_key" UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT users_email_key UNIQUE (email)
    );
  output: ""

CreateUnquotedWhenQuotedMixedCaseExists:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
  desired: |
    CREATE TABLE "Users" (id int);
    CREATE TABLE users (id int);
  output: |
    CREATE TABLE users (id int);

ForeignKeyAutoNameWithQuotedColumn:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE categories (id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      "CategoryId" int
    );
  desired: |
    CREATE TABLE categories (id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      "CategoryId" int REFERENCES categories (id)
    );
  output: |
    ALTER TABLE public.products ADD CONSTRAINT products_categoryid_fkey FOREIGN KEY ("CategoryId") REFERENCES public.categories (id);

CheckConstraintQuotedMixedCaseName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (id int, price int);
  desired: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT "PriceMustBePositive" CHECK (price > 0)
    );
  output: |
    ALTER TABLE public.products ADD CONSTRAINT "PriceMustBePositive" CHECK (price > 0);

DropCheckConstraintQuotedMixedCaseName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT "PriceMustBePositive" CHECK (price > 0)
    );
  desired: |
    CREATE TABLE products (id int, price int);
  output: |
    ALTER TABLE public.products DROP CONSTRAINT "PriceMustBePositive";

MultipleColumnsQuotedVsUnquotedSameName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "Name" text,
      name text
    );
  desired: |
    CREATE TABLE users (
      id int,
      "Name" text NOT NULL,
      name text NOT NULL
    );
  output: |
    ALTER TABLE public.users ALTER COLUMN "Name" SET NOT NULL;
    ALTER TABLE public.users ALTER COLUMN name SET NOT NULL;

DropQuotedColumnKeepUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "Name" text,
      name text
    );
  desired: |
    CREATE TABLE users (
      id int,
      name text
    );
  output: |
    ALTER TABLE public.users DROP COLUMN "Name";

UniqueConstraintOnQuotedColumn:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "Email" text
    );
  desired: |
    CREATE TABLE users (
      id int,
      "Email" text,
      CONSTRAINT "users_Email_key" UNIQUE ("Email")
    );
  output: |
    ALTER TABLE public.users ADD CONSTRAINT "users_Email_key" UNIQUE ("Email");

PrimaryKeyOnQuotedColumn:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users ("UserId" int);
  desired: |
    CREATE TABLE users ("UserId" int PRIMARY KEY);
  output: |
    ALTER TABLE public.users ADD PRIMARY KEY ("UserId");

IndexOnMixedQuotedColumns:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      "FirstName" text,
      last_name text
    );
  desired: |
    CREATE TABLE users (
      id int,
      "FirstName" text,
      last_name text
    );
    CREATE INDEX name_idx ON users ("FirstName", last_name);
  output: |
    CREATE INDEX name_idx ON users ("FirstName", last_name);

# =============================================================================
# Edge case tests for Issue 3: Schema name comparison
# In quote-aware mode, quoted schema "MySchema" should be different from
# unquoted myschema (which normalizes to lowercase)
# =============================================================================

QuotedSchemaVsUnquotedSchemaDifferent:
  legacy_ignore_quotes: false
  current: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema".test (id int);
  desired: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema".test (id int);
    CREATE SCHEMA myschema;
    CREATE TABLE myschema.test (name text);
  output: |
    CREATE SCHEMA myschema;
    CREATE TABLE myschema.test (name text);

QuotedSchemaVsUnquotedSchemaModifyBoth:
  legacy_ignore_quotes: false
  current: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema".users (id int);
    CREATE SCHEMA myschema;
    CREATE TABLE myschema.users (id int);
  desired: |
    CREATE SCHEMA "MySchema";
    CREATE TABLE "MySchema".users (id int, quoted_col text);
    CREATE SCHEMA myschema;
    CREATE TABLE myschema.users (id int, unquoted_col text);
  output: |
    ALTER TABLE "MySchema".users ADD COLUMN quoted_col text;
    ALTER TABLE myschema.users ADD COLUMN unquoted_col text;

# =============================================================================
# Edge case tests for Issue 4: escapeAndJoinColumns missing quote-awareness
# Foreign key columns should preserve quoting: unquoted columns should NOT
# be quoted in the output in quote-aware mode
# =============================================================================

# Note: In quote-aware mode, the default schema (public) is unquoted since it was never explicitly quoted.
# Reference table names are currently always quoted due to implementation limitations
# (ForeignKey.referenceName is stored as string without quote info).
# The key behavior being tested is that column names preserve their original quoting.

ForeignKeyUnquotedColumnsNotQuoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (id int PRIMARY KEY, user_id int);
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users (id)
    );
  output: |
    ALTER TABLE public.orders ADD CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES public.users (id);

ForeignKeyMixedQuotedColumns:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE parent (
      "ParentId" int PRIMARY KEY
    );
    CREATE TABLE child (
      id int PRIMARY KEY,
      "ParentId" int,
      parent_code text
    );
  desired: |
    CREATE TABLE parent (
      "ParentId" int PRIMARY KEY
    );
    CREATE TABLE child (
      id int PRIMARY KEY,
      "ParentId" int,
      parent_code text,
      CONSTRAINT fk_parent FOREIGN KEY ("ParentId") REFERENCES parent ("ParentId")
    );
  output: |
    ALTER TABLE public.child ADD CONSTRAINT fk_parent FOREIGN KEY ("ParentId") REFERENCES public.parent ("ParentId");

ForeignKeyQuotedColumnToUnquotedColumn:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE categories (category_id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      "CategoryId" int
    );
  desired: |
    CREATE TABLE categories (category_id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      "CategoryId" int,
      CONSTRAINT fk_category FOREIGN KEY ("CategoryId") REFERENCES categories (category_id)
    );
  output: |
    ALTER TABLE public.products ADD CONSTRAINT fk_category FOREIGN KEY ("CategoryId") REFERENCES public.categories (category_id);

# =============================================================================
# Tests for FK constraint name comparison (quote-aware)
# =============================================================================

# Quoted lowercase FK name equals unquoted FK name - they should be considered the same
ForeignKeyConstraintQuotedLowercaseEqualsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "fk_user" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users (id)
    );
  output: ""

# Quoted mixed-case FK name differs from unquoted FK name
# "FK_User" (preserves case) is different from fk_user (normalizes to lowercase)
ForeignKeyConstraintQuotedMixedCaseDiffersFromUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_User" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users (id)
    );
  output: |
    ALTER TABLE public.orders ADD CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES public.users (id);
    ALTER TABLE public.orders DROP CONSTRAINT "FK_User";

# Change quoted FK name to a different quoted name
ForeignKeyRenameQuotedConstraint:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_Old_Name" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_New_Name" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  output: |
    ALTER TABLE public.orders ADD CONSTRAINT "FK_New_Name" FOREIGN KEY (user_id) REFERENCES public.users (id);
    ALTER TABLE public.orders DROP CONSTRAINT "FK_Old_Name";
