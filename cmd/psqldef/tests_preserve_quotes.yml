TableQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
  desired: |
    CREATE TABLE "Users" (id int, name text);
  output: |
    ALTER TABLE "public"."Users" ADD COLUMN name text;

TableUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE Users (id int);
  desired: |
    CREATE TABLE Users (id int, name text);
  output: |
    ALTER TABLE "public".users ADD COLUMN name text;

TableQuotedVsUnquotedAreDifferent:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
    CREATE TABLE users (id int);
  desired: |
    CREATE TABLE "Users" (id int, name text);
    CREATE TABLE users (id int, email text);
  output: |
    ALTER TABLE "public"."Users" ADD COLUMN name text;
    ALTER TABLE "public".users ADD COLUMN email text;

ColumnQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users ("Name" text);
  desired: |
    CREATE TABLE users ("Name" text NOT NULL);
  output: |
    ALTER TABLE "public".users ALTER COLUMN "Name" SET NOT NULL;

ColumnUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (Name text);
  desired: |
    CREATE TABLE users (Name text NOT NULL);
  output: |
    ALTER TABLE "public".users ALTER COLUMN name SET NOT NULL;

ColumnQuotedVsUnquotedAreDifferent:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users ("Name" text, name text);
  desired: |
    CREATE TABLE users ("Name" text NOT NULL, name text NOT NULL);
  output: |
    ALTER TABLE "public".users ALTER COLUMN "Name" SET NOT NULL;
    ALTER TABLE "public".users ALTER COLUMN name SET NOT NULL;

ViewQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int, name text);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
  output: |
    ALTER TABLE "public".users ADD COLUMN name text;

ViewUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW ActiveUsers AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int, name text);
    CREATE VIEW ActiveUsers AS SELECT id FROM users;
  output: |
    ALTER TABLE "public".users ADD COLUMN name text;

TypeQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE "UserStatus" AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status "UserStatus");
  desired: |
    CREATE TYPE "UserStatus" AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status "UserStatus", name text);
  output: |
    ALTER TABLE "public".users ADD COLUMN name text;

TypeUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE UserStatus AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status userstatus);
  desired: |
    CREATE TYPE UserStatus AS ENUM ('active', 'inactive');
    CREATE TABLE users (id int, status userstatus, name text);
  output: |
    ALTER TABLE "public".users ADD COLUMN name text;

DomainQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE DOMAIN "PositiveInt" AS int CHECK (VALUE > 0);
    CREATE TABLE users (id "PositiveInt");
  desired: |
    CREATE DOMAIN "PositiveInt" AS int CHECK (VALUE > 0);
    CREATE TABLE users (id "PositiveInt", score "PositiveInt");
  output: |
    ALTER TABLE "public".users ADD COLUMN score "PositiveInt";

DomainUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE DOMAIN PositiveInt AS int CHECK (VALUE > 0);
    CREATE TABLE users (id positiveint);
  desired: |
    CREATE DOMAIN PositiveInt AS int CHECK (VALUE > 0);
    CREATE TABLE users (id positiveint, score positiveint);
  output: |
    ALTER TABLE "public".users ADD COLUMN score positiveint;

IndexQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX "EmailIndex" ON users (email);
  desired: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX "EmailIndex" ON users (email);
  output: |
    ALTER TABLE "public".users ADD COLUMN name text;

IndexUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX EmailIndex ON users (email);
  desired: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX EmailIndex ON users (email);
  output: |
    ALTER TABLE "public".users ADD COLUMN name text;

ConstraintQuotedPreservesCase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int CONSTRAINT "PrimaryKey" PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int CONSTRAINT "PrimaryKey" PRIMARY KEY, email text UNIQUE);
  output: |
    ALTER TABLE "public".users ADD COLUMN email text UNIQUE;

ConstraintUnquotedNormalizesToLowercase:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int CONSTRAINT PrimaryKey PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int CONSTRAINT PrimaryKey PRIMARY KEY, email text UNIQUE);
  output: |
    ALTER TABLE "public".users ADD COLUMN email text UNIQUE;

MixedQuotedAndUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
    CREATE TABLE users (id int);
  desired: |
    CREATE TABLE "Users" ("Name" text);
    CREATE TABLE users (name text);
  output: |
    ALTER TABLE "public"."Users" ADD COLUMN "Name" text;
    ALTER TABLE "public".users ADD COLUMN name text;
    ALTER TABLE "public"."Users" DROP COLUMN id;
    ALTER TABLE "public".users DROP COLUMN id;

ComplexMixedCaseScenario:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "UserProfiles" (
      "UserId" int,
      user_name text
    );
  desired: |
    CREATE TABLE "UserProfiles" (
      "UserId" int PRIMARY KEY,
      user_name text NOT NULL,
      "CreatedAt" timestamp DEFAULT CURRENT_TIMESTAMP
    );
  output: |
    ALTER TABLE "public"."UserProfiles" ALTER COLUMN user_name SET NOT NULL;
    ALTER TABLE "public"."UserProfiles" ADD COLUMN "CreatedAt" timestamp DEFAULT current_timestamp;
    ALTER TABLE "public"."UserProfiles" ADD PRIMARY KEY ("UserId");

# Foreign key tests with quoted table/column names
ForeignKeyToQuotedTable:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (
      "UserId" int PRIMARY KEY
    );
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int
    );
  desired: |
    CREATE TABLE "Users" (
      "UserId" int PRIMARY KEY
    );
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES "Users" ("UserId")
    );
  output: |
    ALTER TABLE "public".orders ADD CONSTRAINT "fk_user" FOREIGN KEY ("user_id") REFERENCES "public"."Users" ("UserId");

ForeignKeyWithQuotedConstraintName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (id int PRIMARY KEY, user_id int);
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_Orders_Users" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  output: |
    ALTER TABLE "public".orders ADD CONSTRAINT "FK_Orders_Users" FOREIGN KEY ("user_id") REFERENCES "public"."users" ("id");

ForeignKeyBetweenQuotedAndUnquotedTables:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE "Orders" (id int PRIMARY KEY, quoted_user_id int, unquoted_user_id int);
  desired: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE "Orders" (
      id int PRIMARY KEY,
      quoted_user_id int,
      unquoted_user_id int,
      CONSTRAINT "fk_quoted" FOREIGN KEY (quoted_user_id) REFERENCES "Users" ("UserId"),
      CONSTRAINT fk_unquoted FOREIGN KEY (unquoted_user_id) REFERENCES users (id)
    );
  output: |
    ALTER TABLE "public"."Orders" ADD CONSTRAINT "fk_quoted" FOREIGN KEY ("quoted_user_id") REFERENCES "public"."Users" ("UserId");
    ALTER TABLE "public"."Orders" ADD CONSTRAINT "fk_unquoted" FOREIGN KEY ("unquoted_user_id") REFERENCES "public"."users" ("id");

# Array type with quoted custom type
ArrayTypeWithQuotedCustomType:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE "UserRole" AS ENUM ('admin', 'user');
    CREATE TABLE users (id int);
  desired: |
    CREATE TYPE "UserRole" AS ENUM ('admin', 'user');
    CREATE TABLE users (id int, roles "UserRole"[]);
  output: |
    ALTER TABLE "public".users ADD COLUMN roles "UserRole"[];

ArrayTypeWithUnquotedCustomType:
  legacy_ignore_quotes: false
  current: |
    CREATE TYPE userrole AS ENUM ('admin', 'user');
    CREATE TABLE users (id int);
  desired: |
    CREATE TYPE userrole AS ENUM ('admin', 'user');
    CREATE TABLE users (id int, roles userrole[]);
  output: |
    ALTER TABLE "public".users ADD COLUMN roles userrole[];

# Check constraint with quoted name - verifies that quoted constraint names preserve case
CheckConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (id int, price int);
  desired: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT "Price_Positive" CHECK (price > 0)
    );
  output: |
    ALTER TABLE "public".products ADD CONSTRAINT "Price_Positive" CHECK (price > 0);

# Quoted vs unquoted CHECK constraint names should be treated as different
# "Price_Check" (quoted) != Price_Check (unquoted, normalizes to price_check)
CheckConstraintQuotedVsUnquotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT "Price_Check" CHECK (price > 0)
    );
  desired: |
    CREATE TABLE products (
      id int,
      price int CONSTRAINT Price_Check CHECK (price > 0)
    );
  output: |
    ALTER TABLE "public".products DROP CONSTRAINT "Price_Check";
    ALTER TABLE "public".products ADD CONSTRAINT price_check CHECK (price > 0);

UniqueConstraintQuotedColumns:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users ("Email" text, "Username" text);
  desired: |
    CREATE TABLE users (
      "Email" text,
      "Username" text,
      CONSTRAINT "unique_email" UNIQUE ("Email")
    );
  output: |
    ALTER TABLE "public"."users" ADD CONSTRAINT "unique_email" UNIQUE ("Email");

DropTableQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
  desired: ""
  output: |
    DROP TABLE "public"."Users";

DropTableQuotedVsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" (id int);
    CREATE TABLE users (id int);
  desired: |
    CREATE TABLE users (id int);
  output: |
    DROP TABLE "public"."Users";

DropIndexQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text);
    CREATE INDEX "EmailIndex" ON users (email);
  desired: |
    CREATE TABLE users (id int, email text);
  output: |
    DROP INDEX "public"."EmailIndex";

DropIndexQuotedVsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX "NameIndex" ON users (name);
    CREATE INDEX emailindex ON users (email);
  desired: |
    CREATE TABLE users (id int, email text, name text);
    CREATE INDEX emailindex ON users (email);
  output: |
    DROP INDEX "public"."NameIndex";

DropViewQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int);
  output: |
    DROP VIEW "public"."ActiveUsers";

DropViewQuotedVsUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int);
    CREATE VIEW "ActiveUsers" AS SELECT id FROM users;
    CREATE VIEW activeusers AS SELECT id FROM users;
  desired: |
    CREATE TABLE users (id int);
    CREATE VIEW activeusers AS SELECT id FROM users;
  output: |
    DROP VIEW "public"."ActiveUsers";

DropForeignKeyQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_Orders_Users" FOREIGN KEY (user_id) REFERENCES users (id)
    );
  desired: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (id int PRIMARY KEY, user_id int);
  output: |
    ALTER TABLE "public"."orders" DROP CONSTRAINT "FK_Orders_Users";

DropUniqueConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT "Unique_Email" UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (id int, email text);
  output: |
    ALTER TABLE "public"."users" DROP CONSTRAINT "Unique_Email";

DropCheckConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE products (
      id int,
      price int,
      CONSTRAINT "Price_Positive" CHECK (price > 0)
    );
  desired: |
    CREATE TABLE products (id int, price int);
  output: |
    ALTER TABLE "public".products DROP CONSTRAINT "Price_Positive";

QuotedReservedWordAsTableName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "select" (id int);
  desired: |
    CREATE TABLE "select" (id int, "from" text);
  output: |
    ALTER TABLE "public"."select" ADD COLUMN "from" text;

DropQuotedReservedWordTable:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "table" (id int);
  desired: ""
  output: |
    DROP TABLE "public"."table";

QuotedIdentifierWithSpace:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "User Profiles" (id int);
  desired: |
    CREATE TABLE "User Profiles" (id int, "Full Name" text);
  output: |
    ALTER TABLE "public"."User Profiles" ADD COLUMN "Full Name" text;

ModifyUniqueConstraintQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      name text,
      CONSTRAINT "Unique_Email" UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (
      id int,
      email text,
      name text,
      CONSTRAINT "Unique_Email" UNIQUE (email, name)
    );
  output: |
    ALTER TABLE "public"."users" DROP CONSTRAINT "Unique_Email";
    ALTER TABLE "public"."users" ADD CONSTRAINT "Unique_Email" UNIQUE ("email", "name");

RenameUniqueConstraintQuotedToUnquoted:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT "Email_Unique" UNIQUE (email)
    );
  desired: |
    CREATE TABLE users (
      id int,
      email text,
      CONSTRAINT email_unique UNIQUE (email)
    );
  output: |
    ALTER TABLE "public"."users" ADD CONSTRAINT email_unique UNIQUE ("email");
    ALTER TABLE "public"."users" DROP CONSTRAINT "Email_Unique";

ForeignKeyMixedQuotedReferences:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Categories" ("CategoryId" int PRIMARY KEY);
    CREATE TABLE categories (id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      quoted_cat_id int,
      unquoted_cat_id int
    );
  desired: |
    CREATE TABLE "Categories" ("CategoryId" int PRIMARY KEY);
    CREATE TABLE categories (id int PRIMARY KEY);
    CREATE TABLE products (
      id int PRIMARY KEY,
      quoted_cat_id int,
      unquoted_cat_id int,
      CONSTRAINT "fk_QuotedCat" FOREIGN KEY (quoted_cat_id) REFERENCES "Categories" ("CategoryId"),
      CONSTRAINT fk_unquoted_cat FOREIGN KEY (unquoted_cat_id) REFERENCES categories (id)
    );
  output: |
    ALTER TABLE "public".products ADD CONSTRAINT "fk_QuotedCat" FOREIGN KEY ("quoted_cat_id") REFERENCES "public"."Categories" ("CategoryId");
    ALTER TABLE "public".products ADD CONSTRAINT "fk_unquoted_cat" FOREIGN KEY ("unquoted_cat_id") REFERENCES "public"."categories" ("id");

DropForeignKeyKeepQuotedTable:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE "Orders" (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT "FK_Order_User" FOREIGN KEY (user_id) REFERENCES "Users" ("UserId")
    );
  desired: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
    CREATE TABLE "Orders" (id int PRIMARY KEY, user_id int);
  output: |
    ALTER TABLE "public"."Orders" DROP CONSTRAINT "FK_Order_User";

AddPrimaryKeyQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE "Users" ("UserId" int);
  desired: |
    CREATE TABLE "Users" ("UserId" int PRIMARY KEY);
  output: |
    ALTER TABLE "public"."Users" ADD PRIMARY KEY ("UserId");

DropPrimaryKeyQuotedName:
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE users (id int PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int NOT NULL);
  output: |
    ALTER TABLE "public".users DROP CONSTRAINT users_pkey;
