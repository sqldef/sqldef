# yaml-language-server: $schema=../testutils/testcase.schema.json
CreatePolicy:
  current: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
  desired: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
    CREATE POLICY p_users ON users AS PERMISSIVE FOR ALL TO PUBLIC USING (id = (current_user)::integer) WITH CHECK ((current_user)::integer = 1);
  up: |
    CREATE POLICY p_users ON users AS PERMISSIVE FOR ALL TO PUBLIC USING (id = (current_user)::integer) WITH CHECK ((current_user)::integer = 1);
  down: |
    DROP POLICY "p_users" ON "public"."users";
ModifyPolicyToRestrictive:
  current: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
    CREATE POLICY p_users ON users AS PERMISSIVE FOR ALL TO PUBLIC USING (id = (current_user)::integer) WITH CHECK ((current_user)::integer = 1);
  desired: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (id = (current_user)::integer);
  up: |
    DROP POLICY "p_users" ON "public"."users";
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (id = (current_user)::integer);
  down: |
    DROP POLICY "p_users" ON "public"."users";
    CREATE POLICY p_users ON users AS PERMISSIVE FOR ALL TO PUBLIC USING (id = (current_user)::integer) WITH CHECK ((current_user)::integer = 1);
ModifyPolicyUsing:
  current: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (id = (current_user)::integer);
  desired: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (true);
  up: |
    DROP POLICY "p_users" ON "public"."users";
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (true);
  down: |
    DROP POLICY "p_users" ON "public"."users";
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (id = (current_user)::integer);
DropPolicy:
  current: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (true);
  desired: |
    CREATE TABLE users (id BIGINT PRIMARY KEY, name character varying(100));
  up: |
    DROP POLICY "p_users" ON "public"."users";
  down: |
    CREATE POLICY p_users ON users AS RESTRICTIVE FOR ALL TO postgres USING (true);
