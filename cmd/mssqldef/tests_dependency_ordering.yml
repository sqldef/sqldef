# yaml-language-server: $schema=../../testutil/testcase.schema.json

ViewDependsOnView_Simple:
  desired: |
    CREATE TABLE users (
      id int PRIMARY KEY,
      name nvarchar(100),
      active bit
    );
    CREATE VIEW active_users AS
      SELECT id, name FROM users WHERE active = 1;
    CREATE VIEW active_user_ids AS
      SELECT id FROM active_users;

ViewDependsOnView_ThreeLevelChain:
  desired: |
    CREATE TABLE products (
      id int PRIMARY KEY,
      name nvarchar(100),
      price decimal(10,2),
      available bit
    );
    CREATE VIEW available_products AS
      SELECT id, name, price FROM products WHERE available = 1;
    CREATE VIEW expensive_products AS
      SELECT id, name FROM available_products WHERE price > 100;
    CREATE VIEW expensive_product_ids AS
      SELECT id FROM expensive_products;

ViewDependsOnView_MultipleJoins:
  desired: |
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      total decimal(10,2)
    );
    CREATE TABLE order_items (
      id int PRIMARY KEY,
      order_id int,
      quantity int
    );
    CREATE VIEW order_summary AS
      SELECT id, user_id, total FROM orders;
    CREATE VIEW item_summary AS
      SELECT id, order_id, quantity FROM order_items;
    CREATE VIEW complete_order_view AS
      SELECT o.id, o.user_id, o.total, i.quantity
      FROM order_summary o
      JOIN item_summary i ON o.id = i.order_id;

ViewDependsOnView_AggregationChain:
  desired: |
    CREATE TABLE sales (
      id int PRIMARY KEY,
      product_id int,
      amount decimal(10,2),
      sale_date date
    );
    CREATE VIEW daily_sales AS
      SELECT product_id, sale_date, SUM(amount) as total
      FROM sales
      GROUP BY product_id, sale_date;
    CREATE VIEW product_totals AS
      SELECT product_id, SUM(total) as grand_total
      FROM daily_sales
      GROUP BY product_id;
