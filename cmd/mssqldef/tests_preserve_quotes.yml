# Tests for quote-aware mode (legacy_ignore_quotes: false) in MSSQL

ForeignKeyDependencyOrderingCaseMismatch:
  # MSSQL treats Users and users as the same table (case-insensitive).
  # Dependency ordering should correctly recognize this and create
  # users first, then orders.
  legacy_ignore_quotes: false
  desired: |
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES Users (id)
    );
    CREATE TABLE users (id int PRIMARY KEY);
  up: |
    CREATE TABLE users (id int PRIMARY KEY);
    CREATE TABLE orders (
      id int PRIMARY KEY,
      user_id int,
      CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES Users (id)
    );

  down: |
    DROP TABLE dbo.users;
    DROP TABLE dbo.orders;
AddColumnCaseMismatch:
  # Current has USERS, desired has users - should recognize as same table
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE USERS (id int PRIMARY KEY);
  desired: |
    CREATE TABLE users (id int PRIMARY KEY, name varchar(100));
  up: |
    ALTER TABLE dbo.users ADD name varchar(100);

  down: |
    ALTER TABLE dbo.USERS ALTER COLUMN id int NOT NULL;
    ALTER TABLE dbo.USERS DROP COLUMN name;
DropColumnCaseMismatch:
  # Current has Users, desired has USERS - should recognize as same table
  legacy_ignore_quotes: false
  current: |
    CREATE TABLE Users (id int PRIMARY KEY, old_col varchar(50));
  desired: |
    CREATE TABLE USERS (id int PRIMARY KEY);
  up: |
    ALTER TABLE dbo.USERS DROP COLUMN [old_col];

  down: |
    ALTER TABLE dbo.Users ALTER COLUMN id int NOT NULL;
    ALTER TABLE dbo.Users ADD old_col varchar(50);
